<script>
  const KEY = 'projectId'
  let params = new URLSearchParams(location.search)
  let entries = Object.fromEntries(params)
  let redirectUrl
  if (entries.projectId == undefined) {
    localStorage.removeItem(KEY)
    redirectUrl = `https://script.google.com/macros/d/${localStorage.getItem(KEY)}/usercallback${location.search}`
  } else {
    localStorage.setItem(KEY, entries.projectId)
    delete params[KEY]
    redirectUrl = params.toString()
  }
  window.open(redirectUrl, "_self")
</script>
